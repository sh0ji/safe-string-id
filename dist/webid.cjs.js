/***
 * WebId v2.1.0 (https://github.com/sh0ji/web-id#readme)
 * Built for Node.js
 * Copyright 2017-2019 Evan Yamanishi
 * Licensed under MIT
 ***/
"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var short=_interopDefault(require("shortid")),slugify=_interopDefault(require("slugify"));function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var defineProperty=_defineProperty;const getCharacters=e=>{const t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_";return e?t.replace(e,"~"===e?"-":"~"):t},DefaultOptions={delimiter:"-",delimiterInShortid:!1,lower:!0,maxLength:128,remove:null,strict:!0},Private={delimiter:new WeakMap,prefix:new WeakMap,suffix:new WeakMap},Errors={TYPE_IS_STRING:e=>({assertion:"string"==typeof e,error:new TypeError("Expected a string. Received ".concat(typeof e,"."))}),STRICT_DELIMITER:e=>({assertion:/^[\w-._~]*$/.test(e),error:new Error("".concat(e," is not a safe delimiter."))}),NON_STRICT_DELIMITER:e=>({assertion:/^\S*$/g.test(e),error:new Error("The delimiter cannot be a space.")}),VALID_PREFIX:e=>({assertion:/^[a-z]+/i.test(e),error:new Error("prefix must begin with a letter (a-z).")})},Assertions=(()=>{const e={};return Object.keys(Errors).forEach(t=>{e[t]=e=>{const r=Errors[t](e);if(!r.assertion)throw r.error}}),e})();function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(r,!0).forEach(function(t){defineProperty(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class WebId{constructor(e={}){this.configure(e)}get delimiter(){return Private.delimiter.get(this)}set delimiter(e){this.options.strict?Assertions.STRICT_DELIMITER(e):Assertions.NON_STRICT_DELIMITER(e),Private.delimiter.set(this,e)}get prefix(){return Private.prefix.get(this)}set prefix(e){if(!e)return void Private.prefix.set(this,"");Assertions.TYPE_IS_STRING(e),this.options.strict&&Assertions.VALID_PREFIX(e);let t=this.createSlug(e.trim(),null);t&&!t.endsWith(this.delimiter)&&(t+=this.delimiter),Private.prefix.set(this,t)}get suffix(){return Private.suffix.get(this)}set suffix(e){if(!e)return void Private.suffix.set(this,"");Assertions.TYPE_IS_STRING(e);let t=this.createSlug(e.trim(),null);t&&!t.startsWith(this.delimiter)&&(t=this.delimiter+t),Private.suffix.set(this,t)}slugifyOpts(e){return{replacement:e,remove:this.options.remove,lower:this.options.lower}}createSlug(e,t=this.delimiter){const r=e?slugify(e,this.slugifyOpts(t)):"";return this.options.strict?r.replace(/[^\w_:.-]/gi,this.delimiter).replace(/^[^a-z]+/,""):r}configure(e={}){this.options=_objectSpread({},DefaultOptions,{},e),this.delimiter=this.options.delim||this.options.delimiter,this.prefix=this.options.pre||this.options.prefix,this.suffix=this.options.suf||this.options.suffix}parse(e,t){const r="string"==typeof e?e:"",i="object"==typeof e?e:t;i&&this.configure(i);const s=this.createSlug(r);short.characters(getCharacters(this.options.delimiterInShortid?null:this.delimiter));const o=short.generate(),n=this.options.maxLength-this.prefix.length-this.suffix.length,f=s?[s.substr(0,n-o.length),o].join(this.delimiter):o;return{id:this.prefix+(s.substr(0,n)||o)+this.suffix,unique:this.prefix+f+this.suffix,original:r,slug:s,shortid:o,delimiter:this.delimiter,prefix:this.prefix,suffix:this.suffix}}generate(e,t){return this.parse(e,t).id}generateUnique(e,t){return this.parse(e,t).unique}}module.exports=WebId;
